<nav class="navbar navbar-dark bg-dark py-3 mb-0" style="border-radius: 0 0 1rem 1rem;">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <span class="navbar-brand mb-0 h1 d-flex align-items-center">
                <a href="{{ url_for('dashboard') }}" class="text-decoration-none text-white d-flex align-items-center">
                <img src="{{ url_for('static', filename='nimbus-icon.png') }}" alt="Nimbus Logo" style="height: 30px; margin-right: 10px;"> 
                <span class="fw-bold">Nimbus</span>
                <span class="text-muted ms-2 small">A Document Mind</span>
            </a>
        </span>
        
        <div class="d-flex align-items-center gap-3">
            <span class="text-white-50 small">
                <i class="bi bi-person-circle"></i> 
                Logged in as <strong class="text-white">{{ session.get('username', 'User') }}</strong>
                {% if session.get('role') == 'admin' %}
                <span class="badge bg-warning text-dark ms-1">ADMIN</span>
                {% endif %}
            </span>
            <div class="dropdown">
                <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <i class="bi bi-person-gear"></i> Account
                </button>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                    <li><a class="dropdown-item" href="{{ url_for('users.change_password') }}" data-no-spa>
                        <i class="bi bi-key"></i> Change Password
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{{ url_for('logout') }}" data-no-spa id="logoutLink">
                        <i class="bi bi-box-arrow-right"></i> Logout
                    </a></li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<style>
.dropdown-menu-dark {
    background-color: #2c3034 !important;
    border: 1px solid #495057 !important;
}

.dropdown-menu-dark .dropdown-item {
    color: #dee2e6 !important;
}

.dropdown-menu-dark .dropdown-item:hover,
.dropdown-menu-dark .dropdown-item:focus {
    background-color: #495057 !important;
    color: #fff !important;
}

.dropdown-menu-dark .dropdown-divider {
    border-color: #495057 !important;
}
</style>

<!-- Session Management JavaScript -->
<script src="{{ url_for('static', filename='session_management.js') }}"></script>
<script>
    // Initialize session management with proper URLs
    document.addEventListener('DOMContentLoaded', function() {
        // Parse the login time from server
        const loginTimeStr = '{{ session.get("login_time", "") }}';
        if (loginTimeStr) {
            sessionStartTime = new Date(loginTimeStr);
        }
        
        // Initialize with URLs
        initSessionManagement('{{ url_for("login") }}', '{{ url_for("logout") }}');
        
        // Clear localStorage on logout
        const logoutLink = document.getElementById('logoutLink');
        if (logoutLink) {
            logoutLink.addEventListener('click', function() {
                // Clear all chat-related localStorage
                localStorage.removeItem('currentSessionId');
                localStorage.removeItem('sidebarCollapsed');
            });
        }
    });
</script>
